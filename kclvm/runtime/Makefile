default:
	make gen-api-spec

gen-api-spec:
	mkdir -p target

	cargo clean -q

	KCLVM_RUNTIME_GEN_API_SPEC= cargo build -r > ./src/_kclvm_api_spec.rs.tmp

	echo "// Copyright The KCL Authors. All rights reserved.\n" > ./src/_kclvm_api_spec.rs
	echo "// Auto generated by <make gen-api-spec> command, DONOT EDIT!!!\n" >> ./src/_kclvm_api_spec.rs
	cat ./src/_kclvm_api_spec.rs.tmp >> ./src/_kclvm_api_spec.rs
	rm  ./src/_kclvm_api_spec.rs.tmp

	cargo run -r --bin gen-api-spec
